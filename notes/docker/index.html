<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Arun S">
        <link rel="canonical" href="https://notes.arunsr.in/notes/docker/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>🐋 Docker - arunsrin's notes</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/solarized-dark.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="../..">arunsrin's notes</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">🏡 Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">🐧About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Books <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../books/" class="dropdown-item">📖Books</a>
</li>
                                    
<li>
    <a href="../../books/2019/" class="dropdown-item">📚 2019</a>
</li>
                                    
<li>
    <a href="../../books/2020/" class="dropdown-item">📚 2020</a>
</li>
                                    
<li>
    <a href="../../books/2021/" class="dropdown-item">📚 2021</a>
</li>
                                    
<li>
    <a href="../../books/2022/" class="dropdown-item">📚 2022</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Intro</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../books/intro/" class="dropdown-item">📃 Oxford - A Very Short Introduction Series</a>
</li>
            
<li>
    <a href="../../books/intro/accounting/" class="dropdown-item">📃 Accounting</a>
</li>
            
<li>
    <a href="../../books/intro/advertising/" class="dropdown-item">📃 Advertising</a>
</li>
            
<li>
    <a href="../../books/intro/alexander/" class="dropdown-item">📃 Alexander the Great</a>
</li>
            
<li>
    <a href="../../books/intro/anaesthesia/" class="dropdown-item">📃 Anaesthesia</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reviews</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../books/reviews/crypto101/" class="dropdown-item">📝 Crypto 101</a>
</li>
            
<li>
    <a href="../../books/reviews/despair/" class="dropdown-item">📝 Despair, by Vladimir Nabokov</a>
</li>
            
<li>
    <a href="../../books/reviews/eats-shoots-leaves/" class="dropdown-item">📝 Eats, Shoots & Leaves</a>
</li>
            
<li>
    <a href="../../books/reviews/flow/" class="dropdown-item">📝 Flow</a>
</li>
            
<li>
    <a href="../../books/reviews/good-math/" class="dropdown-item">📝 Good Math</a>
</li>
            
<li>
    <a href="../../books/reviews/happiness/" class="dropdown-item">📝 The Happiness Hypothesis</a>
</li>
            
<li>
    <a href="../../books/reviews/hate-inc/" class="dropdown-item">📝 Hate Inc.</a>
</li>
            
<li>
    <a href="../../books/reviews/how-to-read-a-book/" class="dropdown-item">📝 How To Read A Book</a>
</li>
            
<li>
    <a href="../../books/reviews/the-art-of-the-infinite/" class="dropdown-item">📝 The Art of the Infinite</a>
</li>
            
<li>
    <a href="../../books/reviews/thinking-climate-change/" class="dropdown-item">📝 The Thinking Person's Guide to Climate Change</a>
</li>
            
<li>
    <a href="../../books/reviews/we-are-our-brains/" class="dropdown-item">📝 We Are Our Brains</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Games <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../games/" class="dropdown-item">🎮Games</a>
</li>
                                    
<li>
    <a href="../../games/2019-and-before/" class="dropdown-item">🎮 2019 and before</a>
</li>
                                    
<li>
    <a href="../../games/2020/" class="dropdown-item">🎮 2020</a>
</li>
                                    
<li>
    <a href="../../games/2021/" class="dropdown-item">🎮 2021</a>
</li>
                                    
<li>
    <a href="../../games/2022/" class="dropdown-item">🎮 2022</a>
</li>
                                    
<li>
    <a href="../../games/xboxone/" class="dropdown-item">🎮Xbox One</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Heroes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../heroes/chomsky/" class="dropdown-item">💭 Noam Chomsky</a>
</li>
                                    
<li>
    <a href="../../heroes/dawkins/" class="dropdown-item">🧬 Richard Dawkins</a>
</li>
                                    
<li>
    <a href="../../heroes/sagan/" class="dropdown-item">🌌 Carl Sagan</a>
</li>
                                    
<li>
    <a href="../../heroes/stallman/" class="dropdown-item">🐧 Richard Stallman</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Notes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../ansible/" class="dropdown-item">🅰️ Ansible</a>
</li>
                                    
<li>
    <a href="../aws/" class="dropdown-item">☁️ AWS</a>
</li>
                                    
<li>
    <a href="../browsers/" class="dropdown-item">🌐 Browsers</a>
</li>
                                    
<li>
    <a href="../databases/" class="dropdown-item">💾 Databases</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">🐋 Docker</a>
</li>
                                    
<li>
    <a href="../editors/" class="dropdown-item">⌨️ Editors</a>
</li>
                                    
<li>
    <a href="../elastic/" class="dropdown-item">🔍 Elastic Stack</a>
</li>
                                    
<li>
    <a href="../git/" class="dropdown-item">💾 Git</a>
</li>
                                    
<li>
    <a href="../grafana/" class="dropdown-item">📈 Grafana</a>
</li>
                                    
<li>
    <a href="../k8s/" class="dropdown-item">☸️ Kubernetes</a>
</li>
                                    
<li>
    <a href="../kafka/" class="dropdown-item">🐞 Kafka</a>
</li>
                                    
<li>
    <a href="../networking/" class="dropdown-item">🕸️ Networking</a>
</li>
                                    
<li>
    <a href="../openssl/" class="dropdown-item">🔒 OpenSSL</a>
</li>
                                    
<li>
    <a href="../security/" class="dropdown-item">🔒 Security</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Linux</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../linux/" class="dropdown-item">🐧Linux</a>
</li>
            
<li>
    <a href="../linux/learnings-and-notes/" class="dropdown-item">🐧 Learnings/Notes</a>
</li>
            
<li>
    <a href="../linux/package-management/" class="dropdown-item">🐧 Package management</a>
</li>
            
<li>
    <a href="../linux/systemd/" class="dropdown-item">🐧Systemd</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Programming</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../programming/" class="dropdown-item">💻Programming</a>
</li>
            
<li>
    <a href="../programming/go/" class="dropdown-item">🐹 Go</a>
</li>
            
<li>
    <a href="../programming/java/" class="dropdown-item">🍵 Java</a>
</li>
            
<li>
    <a href="../programming/python/" class="dropdown-item">🐍Python notes</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Research <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../research/capitalism/" class="dropdown-item">💰 Capitalism</a>
</li>
                                    
<li>
    <a href="../../research/climate-change/" class="dropdown-item">🌡️ Climate Change</a>
</li>
                                    
<li>
    <a href="../../research/covid-19/" class="dropdown-item">🦠 COVID-19 References</a>
</li>
                                    
<li>
    <a href="../../research/cryptocurrencies/" class="dropdown-item">💸 Cryptocurrencies</a>
</li>
                                    
<li>
    <a href="../../research/philosophy/" class="dropdown-item">💭 Philosophy / Morality</a>
</li>
                                    
<li>
    <a href="../../research/privacy-internet/" class="dropdown-item">🔏 Online Privacy and the Internet</a>
</li>
                                    
<li>
    <a href="../../research/productivity/" class="dropdown-item">✅ Productivity</a>
</li>
                                    
<li>
    <a href="../../research/scepticism/" class="dropdown-item">💭 Scepticism</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../databases/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../editors/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/arunsrin/arunsrin.mkdocs/blob/master/home/notes/docker.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#docker" class="nav-link">🐋 Docker</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#useful-commands" class="nav-link">Useful commands</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cleanup" class="nav-link">Cleanup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#betterfaster-builds" class="nav-link">Better/faster builds</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#dockerfile" class="nav-link">Dockerfile</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#docker-compose-stop-all-containers-when-one-dies" class="nav-link">docker-compose: stop all containers when one dies</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#run-redis-on-windows" class="nav-link">Run redis on windows</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="docker">🐋 Docker</h1>
<p>Once you get a bit of a rhythm with docker, it becomes pretty
fun. Here are notes I took while reading some Docker books. Two good
ones that I'd recommend are:</p>
<ul>
<li>Using Docker</li>
<li>Docker in Action</li>
</ul>
<p>Some <a href="../k8s/">kubernetes</a> notes are here.</p>
<h2 id="useful-commands">Useful commands</h2>
<ul>
<li><code>docker inspect &lt;containerid&gt;</code> - Shows IPAddress among other things.</li>
<li><code>docker diff &lt;containerid&gt;</code> - List of files changed in the container.</li>
<li><code>docker logs &lt;containerid&gt;</code> - list of everything that happened in the container.</li>
<li><code>docker start &lt;containerid&gt;</code> - Start an exited/stopped container. START IS FOR CONTAINERS.</li>
<li>
<p><code>docker rm &lt;containerid&gt;</code> - Remove a container.</p>
</li>
<li>
<p><code>docker run -it --name mynewcontainer centos bash</code> - Run bash in a container called 'mynewcontainer' with centos as the base.</p>
</li>
<li><code>docker commit mynewcontainer arun/mynewcontainer</code> - Create an image out of a container (either running or stopped).</li>
<li><code>docker run arun/mynewcontainer echo hi</code> - Run echo on a new container and exit.</li>
<li><code>docker build -t arun/mynewcontainer .</code> - Read Dockerfile from PWD and build a new container with that tag.</li>
<li><code>docker push arun/mynewcontainer</code> - Push to docker hub or some other registry.</li>
<li><code>docker pull arun/mynewcontainer</code> - Pull from docker hub or some other registry.</li>
<li><code>docker run arun/mynewcontainer</code> &#x2013;name test -d /usr/bin/nginx - daemonize and run a pulled image. RUN IS FOR IMAGES.</li>
<li><code>docker run --rm -it --link myredis:redis redis /bin/bash</code> - Woah. We ran another container and linked it to the existing 'myredis' container as 'redis' on the new one, i.e. /etc/hosts has an entry called 'redis' pointing to the old one.</li>
</ul>
<h2 id="cleanup">Cleanup</h2>
<h3 id="old-and-busted">Old and busted</h3>
<ul>
<li><code>docker rmi $(docker images --filter "dangling=true" -q --no-trunc)</code> - For images</li>
<li><code>docker rm -v $(docker ps -aq -f status=exited)</code> - Remove all exited containers.</li>
</ul>
<h3 id="new-hotness">New hotness</h3>
<ul>
<li><code>docker system prune</code></li>
<li><code>docker container prune</code></li>
<li><code>docker network prune</code></li>
<li><code>docker volume prune</code></li>
</ul>
<p>Difference between Stopped Container and Image: stopped container
retains its changes, settings, metadata, filesystem, runtime
configuration, etc. Images don't have runtime information.</p>
<h2 id="betterfaster-builds">Better/faster builds</h2>
<p>Turn this environment variable on to use the new build kit: </p>
<pre class="codehilite"><code class="language-sh">DOCKER_BUILDKIT=1
</code></pre>

<p>More <a href="https://docs.docker.com/develop/develop-images/build_enhancements/">here</a>.</p>
<h2 id="dockerfile">Dockerfile</h2>
<pre class="codehilite"><code>FROM centos:7
MAINTAINER Beech Team &lt;beechbld@cisco.com&gt;
RUN yum update &amp;&amp; yum install -y emacs
</code></pre>

<p>Note: each command creates a layer, so try to squeeze stuff into a single command.</p>
<p>Then build it like this:</p>
<pre class="codehilite"><code class="language-sh">docker build -t test/myemacs .
</code></pre>

<p>And run it like this:</p>
<pre class="codehilite"><code class="language-sh">docker run test/emacs emacs .bashrc
</code></pre>

<p>If you add this line to the Dockerfile:</p>
<p><code>ENTRYPOINT ["/usr/bin/emacs"]</code></p>
<p>then you can directly run the container and pass the args without
mentioning the command, i.e.</p>
<pre class="codehilite"><code class="language-sh">docker run test/emacs .bashrc
</code></pre>

<p>COPY in a Dockerfile instructs docker to copy a file from the host to the container. e.g.</p>
<p><code>COPY entrypoint.sh /</code></p>
<p>VOLUME is used to just use the host's filesystem for persistent data. e.g.</p>
<p><code>VOLUME /home/arunsrin/data:/root/data</code></p>
<p>To do it at run time, do this:</p>
<pre class="codehilite"><code class="language-sh">docker run -it -v `pwd`:/root arunsrin/testpy
</code></pre>

<p>Instead of VOLUME, if you use ADD or COPY, it'll be baked into the
image and available to anyone who downloads
it. e.g. requirements.txt. Use ADD or COPY for making it part of the
image, and VOLUME for sharing data between host and container. Unlike
COPY, ADD also accepts URLs as a source, and unpacks it if its an
archive. e.g.  </p>
<p><code>ADD . /python-oauth</code></p>
<p>When running a command like <code>docker build -t asda/asd .</code> , the '.' is
the build context. It's contents are tar'd and sent to the docker
daemon so that ADD and COPY commands work seamlessly. Don't run this
on a large folder like <code>~</code> !!</p>
<h2 id="docker-compose-stop-all-containers-when-one-dies">docker-compose: stop all containers when one dies</h2>
<p>From
<a href="https://stackoverflow.com/questions/33799885/how-to-stop-all-containers-when-one-container-stops-with-docker-compose#41841714">here</a>:</p>
<pre class="codehilite"><code>docker-compose up --abort-on-container-exit
</code></pre>

<p>This will stop all containers launched via <code>docker-compose</code> when one of the
containers stops.</p>
<h2 id="run-redis-on-windows">Run redis on windows</h2>
<p>My teams' integration tests need this and I'm the only windows guy!</p>
<p><code>docker run -d -p 6379:6379 redis:6</code></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
